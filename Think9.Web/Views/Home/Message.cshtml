<html>
<head>
    <meta charset="utf-8">
    <title>通知中心</title>
    <link rel="stylesheet" href="~/lib/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="~/lib/font-awesome-4.7.0/css/font-awesome.min.css" media="all">
    <link rel="stylesheet" href="~/css/layuimini.css?v=2.0.1" media="all">
    <link rel="stylesheet" href="~/css/themes/default.css" media="all">
    <link rel="stylesheet" href="~/css/public.css" media="all">
    <style>
        /** 消息列表样式 */
        .layui-badge {
            position: relative;
            display: inline-block;
            padding: 0 6px;
            font-size: 12px;
            text-align: center;
            background-color: #FF5722;
            color: #fff;
            border-radius: 2px;
            left: 40px;
        }

        .layui-badge-yellow {
            margin-top: 5px;
            color: #faad14;
            background: #fff;
            border: 1px solid #ffe58f;
        }

        .layui-badge-green {
            margin-top: 5px;
            color: #52c41a;
            background: #fff;
            border: 1px solid #b7eb8f;
        }

        .layui-badge-red {
            margin-top: 5px;
            color: #f5222d;
            background: #fff;
            border: 1px solid #ffa39e;
        }

        .message-list {
            position: absolute;
            top: 10px;
            padding: 0px 0px;
            left: 0;
            right: 0;
            bottom: 15px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            background: #F2F2F2;
        }

        .setcolor {
            background-color: #fff;
        }

        .message-list-item {
            display: block;
            line-height: 24px;
            position: relative;
            border-bottom: 1px solid #e8e8e8;
        }

            .message-list-item:hover, .message-btn-clear:hover, .message-btn-more:hover {
                background: #F2F2F2;
            }

            .message-list-item .message-item-icon {
                width: 30px;
                height: 30px;
                line-height: 30px;
                margin-top: -20px;
                border-radius: 50%;
                position: absolute;
                left: 40px;
                top: 50%;
            }

                .message-list-item .message-item-icon.layui-icon {
                    color: #fff;
                    font-size: 15px;
                    text-align: center;
                    background-color: #FE5D58;
                    margin-top: -20px;
                }

                .message-list-item .message-item-icon + .message-item-right {
                    margin-left: 40px;
                }

            .message-list-item .message-item-title {
                color: #666;
                font-size: 14px;
                padding-left: 40px;
                cursor: pointer;
            }

            .message-list-item .message-item-text {
                color: #999;
                font-size: 12px;
                padding-left: 40px;
                cursor: pointer;
            }

            .message-list-item .message-item-extra {
                color: #999;
                font-size: 12px;
                padding-left: 40px;
                cursor: pointer;
            }

            .message-list-item .message-item-att {
                color: #999;
                font-size: 12px;
                padding-left: 40px;
            }

            .message-list-item > .layui-badge {
                position: absolute;
                right: 20px;
                top: 12px;
                left: 40px;
                cursor: pointer;
            }

        .message-btn-clear, .message-btn-more {
            color: #666;
            display: block;
            padding: 10px 5px;
            line-height: 24px;
            text-align: center;
            cursor: pointer;
            background-color: #fff;
        }

        .message-btn-clear {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            border-top: 1px solid #e8e8e8;
        }

        .message-btn-more {
            color: #666;
            font-size: 13px;
        }

            .message-btn-more.ew-btn-loading > .ew-btn-loading-text {
                font-size: 13px !important;
            }

        .message-list-empty {
            color: #999;
            padding: 100px 0;
            text-align: center;
            display: none;
        }

            .message-list-empty > .layui-icon {
                color: #ccc;
                display: block;
                font-size: 45px;
                margin-bottom: 15px;
            }

        .show-empty .message-list-empty {
            display: block;
        }

        .show-empty .message-btn-clear, .show-empty .message-list {
            display: none;
        }

        body {
            margin: 5px 0px 5px 0px;
        }
        /** //消息列表样式结束 */
    </style>
    <script src="~/lib/layui/layui.js" charset="utf-8"></script>
    <script src="~/js/global.js" charset="utf-8"></script>
    <script>
        layui.use(['jquery', "element",], function () {
            var $ = layui.$;

            $(function () {
                //todo ajax获取3个信息的参数 进行显示
                $.ajax({
                    url: "/Message/GetUnReadListJson",
                    dataType: "json",
                    async: false,
                    success: function (data) {
                        var num1 = 0;//通知值
                        var num2 = 0;//私信值
                        var num3 = 0;//带办值

                        var html1 = '';
                        var html2 = '';
                        var html3 = '';
                        for (var i = 0; i < data.length; i++) {
                            if (data[i].Type == '0') {
                                num1++;
                                if (data[i].Attachment == null || data[i].Attachment == "") {
                                    html1 += '<div class="message-list-item" id="' + data[i].SmsId + '" href="javascript:;">'
                                        + '<div class="setcolor">'
                                        + '<i class="layui-icon layui-icon-tips message-item-icon"></i>'
                                        + '<div class="message-item-right">'
                                        + '<div class="message-item-title">' + '通知--' + new Date(data[i].createTime).Format("yyyy-MM-dd hh:mm") + '</div>'
                                        + '<div class="message-item-text layui-hide">' + data[i].Subject + '</div>'
                                        + '<div class="message-item-extra">' + data[i].Content + '</div>'
                                        + '</div>'
                                        + '</div >'
                                        + '</div >';
                                }
                                else {
                                    html1 += '<div class="message-list-item" id="' + data[i].SmsId + '" href="javascript:;">'
                                        + '<div class="setcolor">'
                                        + '<i class="layui-icon layui-icon-tips message-item-icon"></i>'
                                        + '<div class="message-item-right">'
                                        + '<div class="message-item-title">' + '通知--' + new Date(data[i].createTime).Format("yyyy-MM-dd hh:mm") + '</div>'
                                        + '<div class="message-item-text layui-hide">' + data[i].Subject + '</div>'
                                        + '<div class="message-item-extra">' + data[i].Content + '</div>'
                                        + '<div class="message-item-att">' + data[i].Attachment + '</div>'
                                        + '</div>'
                                        + '</div >'
                                        + '</div >';
                                }
                            }
                            else if (data[i].Type == 1) {
                                num2++;
                                html2 += '<a class="message-list-item" id="' + data[i].SmsId + '" href="javascript:;">'
                                    + '<div class="setcolor">'
                                    + '<div class="message-item-right">'
                                    + '<div class="message-item-title">' + '私信--' + data[i].FromId + '</div>'
                                    + '<div class="message-item-text layui-hide">' + data[i].Content + '</div>'
                                    + '<div class="message-item-extra">' + new Date(data[i].createTime).Format("yyyy-MM-dd hh:mm") + '</div>'
                                    + '</div>'
                                    + '</div>'
                                    + '</a>';
                            }
                            else {
                                num3++;
                                html3 += '<a class="message-list-item" id="' + data[i].SmsId + '" href="javascript:;" οnclick="ReadSms(' + data[i].SmsId + ')">'
                                    + '<div class="setcolor">'
                                    + '<span class="layui-badge ' + 'layui-badge-yellow' + '">' + '待处理' + '</span>'
                                    + '<div class="message-item-right">'
                                    + '<h2 class="message-item-title">' + data[i].Content + '</h2>'
                                    + '<div class="message-item-text layui-hide">' + '发送人：' + data[i].FromId + '</div>'
                                    + '<div class="message-item-text layui-hide">' + ' 发送时间：' + new Date(data[i].createTime).Format("yyyy-MM-dd hh:mm") + '</div>'
                                    + '<div class="message-item-extra">' + new Date(data[i].createTime).Format("yyyy-MM-dd hh:mm") + '</div>'
                                    + '</div>'
                                    + '</div>'
                                    + '</a>';
                            }
                        }
                        $('#message1').html("通知(" + num1 + ")");
                        $('#message2').html("私信(" + num2 + ")");
                        $('#message3').html("待办(" + num3 + ")");
                        $('#list1').html(html1);
                        $('#list2').html(html2);
                        $('#list3').html(html3);
                        if (num1 == 0) {
                            $('#list1').parents('.layui-tab-item').addClass('show-empty');
                        }
                        if (num2 == 0) {
                            $('#list2').parents('.layui-tab-item').addClass('show-empty');
                        }
                        if (num3 == 0) {
                            $('#list3').parents('.layui-tab-item').addClass('show-empty');
                        }
                    }
                });

            });

            $('body').on('click', '.message-list-item', function () {
                //todo 前后交互，htm2是根据后端数据生成的
                var message = $('.layui-this')[0].id;

                if (message == 'message1') {
                    $.ajax({
                        url: "/Home/ReadNotice",
                        data: { id: this.id },
                        dataType: "json",
                        type: 'POST',
                        success: function () {
                        }
                    });
                    var title = $(this).children('.setcolor').children('.message-item-right').children('.message-item-title').text(),
                        content = $(this).children('.setcolor').children('.message-item-right').children('.message-item-extra').text(),
                        att = $(this).children('.setcolor').children('.message-item-right').children('.message-item-att').html(),
                        noticeTime = $(this).children('.setcolor').children('.message-item-right').children('.message-item-text').text();
                    var html = '<div style="padding:15px 20px; text-align:justify; line-height: 22px;border-bottom:1px solid #e2e2e2;background-color: #2f4056;color: #ffffff">\n' +
                        '<div style="text-align: center;margin-bottom: 20px;font-weight: bold;border-bottom:1px solid #718fb5;padding-bottom: 5px"><h4 class="text-danger">' + title + '</h4></div>\n' +
                        '' + content + '</div>\n';
                    if (att != null && att != undefined && att != '') {
                        html = '<div style="padding:15px 20px; text-align:justify; line-height: 22px;border-bottom:1px solid #e2e2e2;background-color: #2f4056;color: #ffffff">\n' +
                            '<div style="text-align: center;margin-bottom: 20px;font-weight: bold;border-bottom:1px solid #718fb5;padding-bottom: 5px"><h4 class="text-danger">' + title + '</h4></div>\n' + '' + content + "<br> " + att +
                                '</div>\n';
                    }
                    top.layer.open({
                        type: 1,
                        title: '通知' + '<span style="float: right;right: 1px;font-size: 12px;color: #b1b3b9;margin-top: 1px">' + noticeTime + '</span>',
                        area: '250px;',
                        shade: 0.8,
                        id: 'layuimini-notice',
                        btn: ['确定'],
                        btnAlign: 'c',
                        moveType: 1,
                        content: html
                    });
                }
                else if (message == 'message3') {
                    $.ajax({
                        url: "/Home/ReadSms",
                        data: { id: this.id },
                        dataType: "json",
                        type: 'POST',
                        success: function () {
                        }
                    });
                    var title = $(this).children('.setcolor').children('.message-item-right').children('.message-item-title').text(),
                        noticeTime = $(this).children('.setcolor').children('.message-item-right').children('.message-item-extra').text(),
                        content = $(this).children('.setcolor').children('.message-item-right').children('.message-item-text').text();
                    var html = '<div style="padding:15px 20px; text-align:justify; line-height: 22px;border-bottom:1px solid #e2e2e2;background-color: #2f4056;color: #ffffff">\n' +
                        '<div style="text-align: center;margin-bottom: 20px;font-weight: bold;border-bottom:1px solid #718fb5;padding-bottom: 5px"><h4 class="text-danger">' + title + '</h4></div>\n' +
                        '<div style="font-size: 12px">' + content + '</div>\n' +
                        '</div>\n';
                    top.layer.open({
                        type: 1,
                        title: '待办' + '<span style="float: right;right: 1px;font-size: 12px;color: #b1b3b9;margin-top: 1px">' + noticeTime + '</span>',
                        area: '250px;',
                        shade: 0.8,
                        id: 'layuimini-notice',
                        btn: ['确定'],
                        btnAlign: 'c',
                        moveType: 1,
                        content: html
                    });
                }
                else {
                    var Href = $(this).children('.setcolor').children('.message-item-right').children('.message-item-text').html();
                    top.$("[layuimini-href='" + Href + "']", ".layuimini-menu-left").click();
                    common.modalClose();
                }

            });
        });
    </script>
</head>
<body>
    <div class="layui-card" style="box-shadow: none;border: none;">
        <div class="layui-tab layui-tab-brief">
            <ul class="layui-tab-title" style="text-align: center;">
                <li class="layui-this" id="message1"></li>
                <li id="message2" class="layui-hide"></li>
                <li id="message3"></li>
            </ul>
            <div class="layui-tab-content" style="padding: 0;">
                <!-- tab1 -->
                <div class="layui-tab-item layui-show">
                    <div class="message-list" id="list1">
                    </div>
                    <!-- 列表为空 -->
                    <div class="message-list-empty">
                        <i class="layui-icon layui-icon-notice"></i>
                        <div>没有通知</div>
                    </div>
                    <a id="messageClearBtn1" class="message-btn-clear">全部标记已读</a>
                </div>
                <!-- tab2 -->
                <div class="layui-tab-item">
                    <div class="message-list" id="list2">
                    </div>
                    <!-- 列表为空 -->
                    <div class="message-list-empty">
                        <i class="layui-icon layui-icon-dialogue"></i>
                        <div>没有私信</div>
                    </div>
                    <a id="messageClearBtn2" class="message-btn-clear">全部标记已读</a>
                </div>
                <!-- tab3 -->
                <div class="layui-tab-item">
                    <div class="message-list" id="list3">
                    </div>
                    <!-- 列表为空 -->
                    <div class="message-list-empty">
                        <i class="layui-icon layui-icon-flag"></i>
                        <div>没有待办</div>
                    </div>
                    <a id="messageClearBtn3" class="message-btn-clear">全部标记已读</a>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
<script>
    function ReadSms(id) {
        /*alert(id);*/
        $.ajax({
            url: "/Home/ReadSms",
            type: "post",
            data: { id: id },
            dataType: "json",
            async: false,
            success: function (result) {
            }
        });
    }
</script>