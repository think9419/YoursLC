@*控件 适配移动端 查看详细页面 - 列表点击详细打开此页面*@
@*Think9企业级开发工具 http://yourslc.top Create:admin 2024-09-24 13:28:55 列表-此文件放置于Views/Control /中*@

@using Think9.Models;
@{ ViewBag.Title = "MobileDetail";
    Layout = "~/Areas/Shared/_LayuiMobileForm.cshtml";}

<style type="text/css">
    .layui-table-cell {
        height: auto;
        line-height: 35px;
    }
    .layui-table{
        border: 2px solid #fff; /* 不加手机右侧总有两道线 */
    }
</style>

<form class="layui-form layui-form-pane" lay-filter="formUser">
<input style="display:none" id="_listid" value="@ViewBag.ListId">
<input style="display:none" id="_fwid" value="bi_Control">
<input style="display:none" id="_userid" value="@ViewBag.UserId">
<input style="display:none" id="_isMobile" value="y">@*y为移动端*@
<input style="display:none" id="_type" value="detail">
<table class="layui-hide" id="tableId" lay-filter="tableFilter"></table>
<table class="layui-hide" id="tb_Subtable03" lay-filter="tableFilter"> </table>
</form>
<script>
	layui.use(["form", "exLayer", "element", "exUtils",  "table"], function () {
		let form = layui.form;
		let layer = layui.layer;
		let table = layui.table;
		let exLayer = layui.exLayer;
		let exUtils = layui.exUtils;
		let element = layui.element;

		let $ = layui.$;

		form.render();//更新全部表单数据

        //渲染表格，url数据接口参数；cols设置显示字段...
        let ThisTable = table.render({
            elem: "#tableId",
            url: "/_TB/GetMobileDetail" + "?fwid=" + $("#_fwid").val() + "&listid=" + $("#_listid").val() + "&isOriginal=y",
            method: "GET",
            defaultToolbar: [{ title: '关闭', layEvent: 'close', icon: 'layui-icon-close' }],
            toolbar: "#toolbarTpl",
            cols: [[
                { templet: "#mobile_list" }
            ]],
            done: function (res, curr, count) {
                if (count == -1) {
                    //layer.msg(res.msg, { icon: 5, time: 20000, btn: ['关闭'] });//显示错误
                }
                $("#pdf").attr("href", "/_TB/GetDetail?listid=" + $('#_listid').val() + "&type=pdf&fwid=bi_Control&isOriginal=y");
				$("#excel").attr("href", "/_TB/GetDetail?listid=" + $('#_listid').val() + "&type=excel&fwid=bi_Control&isOriginal=y");
				$("#doc").attr("href", "/_TB/GetDetail?listid=" + $('#_listid').val() + "&type=doc&fwid=bi_Control&isOriginal=y");
				$("#att").attr("href", "/Com/FileManage/AttList?listid=" + $('#_listid').val() + "&fwid=bi_Control" + "&isOriginal=y&userid=" + $('#_userid').val());
            }
        });
			
		//渲染表格，url数据接口参数；cols设置显示字段...
		let tb_Subtable03 = table.render({
			elem: "#tb_Subtable03",
			url: "/_TB/GetGridList?tbid=tb_Subtable03"+"&listid=" + $('#_listid').val() + "&from=" + $('#_type').val() + "&fwid=" + $('#_fwid').val()+ "&mobile=" + $('#_isMobile').val(),
			page: false,
			defaultToolbar: [],
			cols: [[
				{ field: "flag",  hide: true }
				,{ field: "v1", title: "日期", width: 130}
				,{ field: "v2", title: "文本框", width: 130}
				,{ field: "v3", title: "弹出选择", width: 130}
				,{ field: "v4", title: "下拉选择", width: 130}
				,{ field: "v5", title: "图片", width: 130, templet: "#tb_Subtable03v5"}
				,{ field: "v6", title: "附件", width: 130}
			]],
			done: function (res, curr, count) {
				$('.layui-table .layui-table-cell > span').css({ 'font-weight': 'bold' });
				
				if (count == -1) {
					layer.msg(res.msg, { icon: 5, time: 20000, btn: ['关闭'] });//显示错误
				}
				
			}
		
		});
        //toolbar监听事件(处理table顶部按钮)
        table.on("toolbar(tableFilter)", function (obj) {
            switch (obj.event) {
                case "close":
                    parent.layer.close(parent.layer.getFrameIndex(window.name));
                    break;
            }
        });
	});
</script>
<!-- 行工具栏模板 -->
<script type='text/html' id='mobile_list'>
	<div class='layui-tab-content'>
		<div class='layui-table-cell' style='margin-left:-25px;margin-right:-25px;'>图片： {{#  if(d.inPicture != null  && d.inPicture != ''){ }}<i class='fa fa-picture-o'></i><span onclick="PopUpImg('{{d.inPicture}}')">点击查看</span>{{#  } else{ }} {{#  } }}</div>
		<div class='layui-table-cell' style='margin-left:-25px;margin-right:-25px;overflow:visible;text-overflow:inherit;white-space:normal;'>日期： {{d.inDate ==  null ? '' : showDate(d.inDate)}}</div>
		<div class='layui-table-cell' style='margin-left:-25px;margin-right:-25px;overflow:visible;text-overflow:inherit;white-space:normal;'>下拉树： {{d.inDropdownTree_Exa ==  null ? '' : d.inDropdownTree_Exa}}</div>
		<div class='layui-table-cell' style='margin-left:-25px;margin-right:-25px;overflow:visible;text-overflow:inherit;white-space:normal;'>弹出选择： {{d.inPopUpSelection ==  null ? '' : d.inPopUpSelection}}</div>
		<div class='layui-table-cell' style='margin-left:-25px;margin-right:-25px;overflow:visible;text-overflow:inherit;white-space:normal;'>多选： {{d.inMultipleChoice_Exa ==  null ? '' : d.inMultipleChoice_Exa}}</div>
		<div class='layui-table-cell' style='margin-left:-25px;margin-right:-25px;overflow:visible;text-overflow:inherit;white-space:normal;'>单选： {{d.inSingleChoice_Exa ==  null ? '' : d.inSingleChoice_Exa}}</div>
		<div class='layui-table-cell' style='margin-left:-25px;margin-right:-25px;overflow:visible;text-overflow:inherit;white-space:normal;'>下拉选择： {{d.inDropdownSelection_Exa ==  null ? '' : d.inDropdownSelection_Exa}}</div>
		<div class='layui-table-cell' style='margin-left:-25px;margin-right:-25px;'>附件： {{#  if(d.inAttachment != null  && d.inAttachment != ''){ }}<i class='fa fa-picture-o'></i><span><a href='~/UserFile/tb_Control_Files/{{d.ListId}}/{{d.inAttachment}}' target='_blank'>点击下载</a></span>{{#  } else{ }} {{#  } }}</div>
	</div>
</script>
<!-- 头工具栏模板 -->
<script type="text/html" id="toolbarTpl">
   <div class="layui-btn-container">
       <a href="" target="_blank" id="pdf" class="layui-btn layui-btn-primary layui-btn-sm"><i class="fa fa-file-pdf-o"></i></a>&nbsp;
       <a href="" target="_blank" id="excel" class="layui-btn layui-btn-primary layui-btn-sm"><i class="fa fa-file-excel-o"></i></a>&nbsp;
        <a href="" target="_blank" id="doc" class="layui-btn layui-btn-primary layui-btn-sm"><i class="fa fa-file-word-o"></i></a>&nbsp;
        <a href="" target="_blank" id="att" class="layui-btn layui-btn-primary layui-btn-sm"><i class="fa fa-file-o"></i></a>
  </div>
</script>
<script type="text/html" id="tb_Subtable03v5">
	{{#  if(d.v5 != null && d.v5 != '点击上传图片' && d.v5 != ''){ }}
		<div><i class='fa fa-picture-o'></i><span onclick="PopUpImg('{{d.v5}}')" lay-tips='{{d.v5}}'>{{d.v5}}</span></div>
	{{#  } else{ }}
	{{#  } }}
</script>
<!-- 图片显示 -->
<script>
    function PopUpImg(id) {
        showImg(id);//在global.js中定义
    }
</script>